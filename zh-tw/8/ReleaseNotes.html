<!DOCTYPE html>

<html lang="zh-TW" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Clang 8.0.0 Release Notes &#8212; Clang 8 說明文件</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="_static/haiku.css?v=fce32b03" />
    <script src="_static/documentation_options.js?v=8c5175a4"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/translations.js?v=cbf116e0"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/clang-docs-l10n/ReleaseNotes.html" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜尋" href="search.html" />
    <link rel="next" title="Clang Compiler User&#39;s Manual" href="UsersManual.html" />
    <link rel="prev" title="Using Clang as a Compiler" href="index.html" />
<script type="text/javascript" src="ltd-provenance.js"></script>
<script type="text/javascript" src="ltd-current.js"></script>
<script type="text/javascript" src="../../ltd-config.js"></script>
<script type="text/javascript" src="../../ltd-flyout.js"></script>

  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>Clang 8 說明文件</span></a></h1>
        <h2 class="heading"><span>Clang 8.0.0 Release Notes</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="Top">
      
        <p>
        «&#160;&#160;<a href="index.html">Using Clang as a Compiler</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">內容</a>
        &#160;&#160;::&#160;&#160;
        <a href="UsersManual.html">Clang Compiler User's Manual</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="clang-8-0-0-release-notes">
<h1>Clang 8.0.0 Release Notes<a class="headerlink" href="#clang-8-0-0-release-notes" title="連結到這個標頭">¶</a></h1>
<nav class="contents local" id="id1">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id2">Introduction</a></p></li>
<li><p><a class="reference internal" href="#what-s-new-in-clang-8-0-0" id="id3">What's New in Clang 8.0.0?</a></p>
<ul>
<li><p><a class="reference internal" href="#major-new-features" id="id4">Major New Features</a></p></li>
<li><p><a class="reference internal" href="#non-comprehensive-list-of-changes-in-this-release" id="id5">Non-comprehensive list of changes in this release</a></p></li>
<li><p><a class="reference internal" href="#new-compiler-flags" id="id6">New Compiler Flags</a></p></li>
<li><p><a class="reference internal" href="#modified-compiler-flags" id="id7">Modified Compiler Flags</a></p></li>
<li><p><a class="reference internal" href="#new-pragmas-in-clang" id="id8">New Pragmas in Clang</a></p></li>
<li><p><a class="reference internal" href="#attribute-changes-in-clang" id="id9">Attribute Changes in Clang</a></p></li>
<li><p><a class="reference internal" href="#windows-support" id="id10">Windows Support</a></p></li>
<li><p><a class="reference internal" href="#opencl-kernel-language-changes-in-clang" id="id11">OpenCL Kernel Language Changes in Clang</a></p></li>
<li><p><a class="reference internal" href="#abi-changes-in-clang" id="id12">ABI Changes in Clang</a></p></li>
<li><p><a class="reference internal" href="#openmp-support-in-clang" id="id13">OpenMP Support in Clang</a></p></li>
<li><p><a class="reference internal" href="#undefined-behavior-sanitizer-ubsan" id="id14">Undefined Behavior Sanitizer (UBSan)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#additional-information" id="id15">Additional Information</a></p></li>
</ul>
</nav>
<p>Written by the <a class="reference external" href="https://llvm.org/">LLVM Team</a></p>
<section id="introduction">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="連結到這個標頭">¶</a></h2>
<p>This document contains the release notes for the Clang C/C++/Objective-C/OpenCL
frontend, part of the LLVM Compiler Infrastructure, release 8.0.0. Here we
describe the status of Clang in some detail, including major
improvements from the previous release and new feature work. For the
general LLVM release notes, see <a class="reference external" href="https://llvm.org/docs/ReleaseNotes.html">the LLVM
documentation</a>. All LLVM
releases may be downloaded
from the <a class="reference external" href="https://releases.llvm.org/">LLVM releases web site</a>.</p>
<p>For more information about Clang or LLVM, including information about the
latest release, please see the <a class="reference external" href="https://clang.llvm.org">Clang Web Site</a> or the
<a class="reference external" href="https://llvm.org">LLVM Web Site</a>.</p>
</section>
<section id="what-s-new-in-clang-8-0-0">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">What's New in Clang 8.0.0?</a><a class="headerlink" href="#what-s-new-in-clang-8-0-0" title="連結到這個標頭">¶</a></h2>
<p>Some of the major new features and improvements to Clang are listed
here. Generic improvements to Clang as a whole or to its underlying
infrastructure are described first, followed by language-specific
sections with improvements to Clang's support for those languages.</p>
<section id="major-new-features">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Major New Features</a><a class="headerlink" href="#major-new-features" title="連結到這個標頭">¶</a></h3>
<ul>
<li><p>Clang supports use of a profile remapping file, which permits
profile data captured for one version of a program to be applied
when building another version where symbols have changed (for
example, due to renaming a class or namespace).
See the <a class="reference internal" href="UsersManual.html#profile-remapping"><span class="std std-ref">UsersManual</span></a> for details.</p></li>
<li><p>Clang has new options to initialize automatic variables with a pattern. The default is still that automatic variables are uninitialized. This isn't meant to change the semantics of C and C++. Rather, it's meant to be a last resort when programmers inadvertently have some undefined behavior in their code. These options aim to make undefined behavior hurt less, which security-minded people will be very happy about. Notably, this means that there's no inadvertent information leak when:</p>
<blockquote>
<div><ul class="simple">
<li><p>The compiler re-uses stack slots, and a value is used uninitialized.</p></li>
<li><p>The compiler re-uses a register, and a value is used uninitialized.</p></li>
<li><p>Stack structs / arrays / unions with padding are copied.</p></li>
</ul>
</div></blockquote>
<p>These options only address stack and register information leaks.</p>
<p>Caveats:</p>
<blockquote>
<div><ul class="simple">
<li><p>Variables declared in unreachable code and used later aren't initialized. This affects goto statements, Duff's device, and other objectionable uses of switch statements. This should instead be a hard-error in any serious codebase.</p></li>
<li><p>These options don't affect volatile stack variables.</p></li>
<li><p>Padding isn't fully handled yet.</p></li>
</ul>
</div></blockquote>
<p>How to use it on the command line:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-ftrivial-auto-var-init=uninitialized</span></code> (the default)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-ftrivial-auto-var-init=pattern</span></code></p></li>
</ul>
</div></blockquote>
<p>There is also a new attribute to request a variable to not be initialized, mainly to disable initialization of large stack arrays when deemed too expensive:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">dont_initialize_me</span> <span class="pre">__attribute((uninitialized));</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ul>
<section id="improvements-to-clang-s-diagnostics">
<h4>Improvements to Clang's diagnostics<a class="headerlink" href="#improvements-to-clang-s-diagnostics" title="連結到這個標頭">¶</a></h4>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">-Wextra-semi-stmt</span></code> is a new diagnostic that diagnoses extra semicolons,
much like <code class="docutils literal notranslate"><span class="pre">-Wextra-semi</span></code>. This new diagnostic diagnoses all <em>unnecessary</em>
null statements (expression statements without an expression), unless: the
semicolon directly follows a macro that was expanded to nothing or if the
semicolon is within the macro itself. This applies to macros defined in system
headers as well as user-defined macros.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#define MACRO(x) int x;</span>
<span class="cp">#define NULLMACRO(varname)</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="c1">// &lt;- warning: &#39;;&#39; with no preceding expression is a null statement</span>

<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">    </span><span class="p">;</span><span class="w"> </span><span class="c1">// OK, it is needed.</span>

<span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">my_enum</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="no">E1</span><span class="p">:</span>
<span class="w">    </span><span class="c1">// stuff</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="no">E2</span><span class="p">:</span>
<span class="w">    </span><span class="p">;</span><span class="w"> </span><span class="c1">// OK, it is needed.</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">MACRO</span><span class="p">(</span><span class="n">v0</span><span class="p">;)</span><span class="w"> </span><span class="c1">// Extra semicolon, but within macro, so ignored.</span>

<span class="w">  </span><span class="n">MACRO</span><span class="p">(</span><span class="n">v1</span><span class="p">);</span><span class="w"> </span><span class="c1">// &lt;- warning: &#39;;&#39; with no preceding expression is a null statement</span>

<span class="w">  </span><span class="n">NULLMACRO</span><span class="p">(</span><span class="n">v2</span><span class="p">);</span><span class="w"> </span><span class="c1">// ignored, NULLMACRO expanded to nothing.</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Wempty-init-stmt</span></code> is a new diagnostic that diagnoses empty init-statements
of <code class="docutils literal notranslate"><span class="pre">if</span></code>, <code class="docutils literal notranslate"><span class="pre">switch</span></code>, <code class="docutils literal notranslate"><span class="pre">range-based</span> <span class="pre">for</span></code>, unless: the semicolon directly
follows a macro that was expanded to nothing or if the semicolon is within the
macro itself (both macros from system headers, and normal macros). This
diagnostic is in the <code class="docutils literal notranslate"><span class="pre">-Wextra-semi-stmt</span></code> group and is enabled in
<code class="docutils literal notranslate"><span class="pre">-Wextra</span></code>.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="p">(;</span><span class="w"> </span><span class="c1">// &lt;- warning: init-statement of &#39;if&#39; is a null statement</span>
<span class="w">     </span><span class="nb">true</span><span class="p">)</span>
<span class="w">    </span><span class="p">;</span>

<span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="c1">// &lt;- warning: init-statement of &#39;switch&#39; is a null statement</span>
<span class="w">          </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="c1">// &lt;- warning: init-statement of &#39;range-based for&#39; is a null statement</span>
<span class="w">       </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">S</span><span class="p">())</span>
<span class="w">    </span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="non-comprehensive-list-of-changes-in-this-release">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Non-comprehensive list of changes in this release</a><a class="headerlink" href="#non-comprehensive-list-of-changes-in-this-release" title="連結到這個標頭">¶</a></h3>
<ul class="simple">
<li><p>The experimental feature Pretokenized Headers (PTH) was removed in its
entirely from Clang. The feature did not properly work with about 1/3 of the
possible tokens available and was unmaintained.</p></li>
<li><p>The internals of libc++ include directory detection on MacOS have changed.
Instead of running a search based on the <code class="docutils literal notranslate"><span class="pre">-resource-dir</span></code> flag, the search
is now based on the path of the compiler in the filesystem. The default
behaviour should not change. However, if you override <code class="docutils literal notranslate"><span class="pre">-resource-dir</span></code>
manually and rely on the old behaviour you will need to add appropriate
compiler flags for finding the corresponding libc++ include directory.</p></li>
<li><p>The integrated assembler is used now by default for all MIPS targets.</p></li>
<li><p>Improved support for MIPS N32 ABI and MIPS R6 target triples.</p></li>
<li><p>Clang now includes builtin functions for bitwise rotation of common value
sizes, such as: <a class="reference external" href="LanguageExtensions.html#builtin-rotateleft">__builtin_rotateleft32</a></p></li>
<li><p>Improved optimization for the corresponding MSVC compatibility builtins such
as <code class="docutils literal notranslate"><span class="pre">_rotl()</span></code>.</p></li>
</ul>
</section>
<section id="new-compiler-flags">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">New Compiler Flags</a><a class="headerlink" href="#new-compiler-flags" title="連結到這個標頭">¶</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">-mspeculative-load-hardening</span></code> Clang now has an option to enable
Speculative Load Hardening.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-fprofile-filter-files=[regexes]</span></code> and <code class="docutils literal notranslate"><span class="pre">-fprofile-exclude-files=[regexes]</span></code>.</p>
<p>Clang has now options to filter or exclude some files when
instrumenting for gcov-based profiling.
See the <a class="reference external" href="UsersManual.html#cmdoption-fprofile-filter-files">UsersManual</a> for details.</p>
</li>
<li><p>When using a custom stack alignment, the <code class="docutils literal notranslate"><span class="pre">stackrealign</span></code> attribute is now
implicitly set on the main function.</p></li>
<li><p>Emission of <code class="docutils literal notranslate"><span class="pre">R_MIPS_JALR</span></code> and <code class="docutils literal notranslate"><span class="pre">R_MICROMIPS_JALR</span></code> relocations can now
be controlled by the <code class="docutils literal notranslate"><span class="pre">-mrelax-pic-calls</span></code> and <code class="docutils literal notranslate"><span class="pre">-mno-relax-pic-calls</span></code>
options.</p></li>
</ul>
</section>
<section id="modified-compiler-flags">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Modified Compiler Flags</a><a class="headerlink" href="#modified-compiler-flags" title="連結到這個標頭">¶</a></h3>
<ul class="simple">
<li><p>As of clang 8, <code class="docutils literal notranslate"><span class="pre">alignof</span></code> and <code class="docutils literal notranslate"><span class="pre">_Alignof</span></code> return the ABI alignment of a type,
as opposed to the preferred alignment. <code class="docutils literal notranslate"><span class="pre">__alignof</span></code> still returns the
preferred alignment. <code class="docutils literal notranslate"><span class="pre">-fclang-abi-compat=7</span></code> (and previous) will make
<code class="docutils literal notranslate"><span class="pre">alignof</span></code> and <code class="docutils literal notranslate"><span class="pre">_Alignof</span></code> return preferred alignment again.</p></li>
</ul>
</section>
<section id="new-pragmas-in-clang">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">New Pragmas in Clang</a><a class="headerlink" href="#new-pragmas-in-clang" title="連結到這個標頭">¶</a></h3>
<ul class="simple">
<li><p>Clang now supports adding multiple <cite>#pragma clang attribute</cite> attributes into
a scope of pushed attributes.</p></li>
</ul>
</section>
<section id="attribute-changes-in-clang">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Attribute Changes in Clang</a><a class="headerlink" href="#attribute-changes-in-clang" title="連結到這個標頭">¶</a></h3>
<ul class="simple">
<li><p>Clang now supports enabling/disabling speculative load hardening on a
per-function basis using the function attribute
<code class="docutils literal notranslate"><span class="pre">speculative_load_hardening</span></code>/<code class="docutils literal notranslate"><span class="pre">no_speculative_load_hardening</span></code>.</p></li>
</ul>
</section>
<section id="windows-support">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Windows Support</a><a class="headerlink" href="#windows-support" title="連結到這個標頭">¶</a></h3>
<ul class="simple">
<li><p>clang-cl now supports the use of the precompiled header options <code class="docutils literal notranslate"><span class="pre">/Yc</span></code> and <code class="docutils literal notranslate"><span class="pre">/Yu</span></code>
without the filename argument. When these options are used without the
filename, a <cite>#pragma hdrstop</cite> inside the source marks the end of the
precompiled code.</p></li>
<li><p>clang-cl has a new command-line option, <code class="docutils literal notranslate"><span class="pre">/Zc:dllexportInlines-</span></code>, similar to
<code class="docutils literal notranslate"><span class="pre">-fvisibility-inlines-hidden</span></code> on non-Windows, that makes class-level
<cite>dllexport</cite> and <cite>dllimport</cite> attributes not apply to inline member functions.
This can significantly reduce compile and link times. See the <a class="reference external" href="UsersManual.html#the-zc-dllexportinlines-option">User's Manual</a> for more info.</p></li>
<li><p>For MinGW, <code class="docutils literal notranslate"><span class="pre">-municode</span></code> now correctly defines <code class="docutils literal notranslate"><span class="pre">UNICODE</span></code> during
preprocessing.</p></li>
<li><p>For MinGW, clang now produces vtables and RTTI for dllexported classes
without key functions. This fixes building Qt in debug mode.</p></li>
<li><p>Allow using Address Sanitizer and Undefined Behaviour Sanitizer on MinGW.</p></li>
<li><p>Structured Exception Handling support for ARM64 Windows. The ARM64 Windows
target is in pretty good shape now.</p></li>
</ul>
</section>
<section id="opencl-kernel-language-changes-in-clang">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">OpenCL Kernel Language Changes in Clang</a><a class="headerlink" href="#opencl-kernel-language-changes-in-clang" title="連結到這個標頭">¶</a></h3>
<p>Misc:</p>
<ul class="simple">
<li><p>Improved address space support with Clang builtins.</p></li>
<li><p>Improved various diagnostics for vectors with element types from extensions;
values used in attributes; duplicate address spaces.</p></li>
<li><p>Allow blocks to capture arrays.</p></li>
<li><p>Allow zero assignment and comparisons between variables of <code class="docutils literal notranslate"><span class="pre">queue_t</span></code> type.</p></li>
<li><p>Improved diagnostics of formatting specifiers and argument promotions for
vector types in <code class="docutils literal notranslate"><span class="pre">printf</span></code>.</p></li>
<li><p>Fixed return type of enqueued kernel and pipe builtins.</p></li>
<li><p>Fixed address space of <code class="docutils literal notranslate"><span class="pre">clk_event_t</span></code> generated in the IR.</p></li>
<li><p>Fixed address space when passing/returning structs.</p></li>
</ul>
<p>Header file fixes:</p>
<ul class="simple">
<li><p>Added missing extension guards around several builtin function overloads.</p></li>
<li><p>Fixed serialization support when registering vendor extensions using pragmas.</p></li>
<li><p>Fixed OpenCL version in declarations of builtin functions with sampler-less
image accesses.</p></li>
</ul>
<p>New vendor extensions added:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cl_intel_planar_yuv</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cl_intel_device_side_avc_motion_estimation</span></code></p></li>
</ul>
<p>C++ for OpenCL:</p>
<ul class="simple">
<li><p>Added support of address space conversions in C style casts.</p></li>
<li><p>Enabled address spaces for references.</p></li>
<li><p>Fixed use of address spaces in templates: address space deduction and diagnostics.</p></li>
<li><p>Changed default address space to work with C++ specific concepts: class members,
template parameters, etc.</p></li>
<li><p>Added generic address space by default to the generated hidden 'this' parameter.</p></li>
<li><p>Extend overload ranking rules for address spaces.</p></li>
</ul>
</section>
<section id="abi-changes-in-clang">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">ABI Changes in Clang</a><a class="headerlink" href="#abi-changes-in-clang" title="連結到這個標頭">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">_Alignof</span></code> and <code class="docutils literal notranslate"><span class="pre">alignof</span></code> now return the ABI alignment of a type, as opposed
to the preferred alignment.</p>
<ul>
<li><p>This is more in keeping with the language of the standards, as well as
being compatible with gcc</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__alignof</span></code> and <code class="docutils literal notranslate"><span class="pre">__alignof__</span></code> still return the preferred alignment of
a type</p></li>
<li><p>This shouldn't break any ABI except for things that explicitly ask for
<code class="docutils literal notranslate"><span class="pre">alignas(alignof(T))</span></code>.</p></li>
<li><p>If you have interfaces that break with this change, you may wish to switch
to <code class="docutils literal notranslate"><span class="pre">alignas(__alignof(T))</span></code>, instead of using the <code class="docutils literal notranslate"><span class="pre">-fclang-abi-compat</span></code>
switch.</p></li>
</ul>
</li>
</ul>
</section>
<section id="openmp-support-in-clang">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">OpenMP Support in Clang</a><a class="headerlink" href="#openmp-support-in-clang" title="連結到這個標頭">¶</a></h3>
<ul class="simple">
<li><p>OpenMP 5.0 features</p>
<ul>
<li><p>Support relational-op != (not-equal) as one of the canonical forms of random
access iterator.</p></li>
<li><p>Added support for mapping of the lambdas in target regions.</p></li>
<li><p>Added parsing/sema analysis for the requires directive.</p></li>
<li><p>Support nested declare target directives.</p></li>
<li><p>Make the <cite>this</cite> pointer implicitly mapped as <cite>map(this[:1])</cite>.</p></li>
<li><p>Added the <cite>close</cite> <em>map-type-modifier</em>.</p></li>
</ul>
</li>
<li><p>Various bugfixes and improvements.</p></li>
</ul>
<p>New features supported for Cuda devices:</p>
<ul class="simple">
<li><p>Added support for the reductions across the teams.</p></li>
<li><p>Extended number of constructs that can be executed in SPMD mode.</p></li>
<li><p>Fixed support for lastprivate/reduction variables in SPMD constructs.</p></li>
<li><p>New collapse clause scheme to avoid expensive remainder operations.</p></li>
<li><p>New default schedule for distribute and parallel constructs.</p></li>
<li><p>Simplified code generation for distribute and parallel in SPMD mode.</p></li>
<li><p>Flag (<code class="docutils literal notranslate"><span class="pre">-fopenmp_optimistic_collapse</span></code>) for user to limit collapsed
loop counter width when safe to do so.</p></li>
<li><p>General performance improvement.</p></li>
</ul>
</section>
<section id="undefined-behavior-sanitizer-ubsan">
<span id="release-notes-ubsan"></span><h3><a class="toc-backref" href="#id14" role="doc-backlink">Undefined Behavior Sanitizer (UBSan)</a><a class="headerlink" href="#undefined-behavior-sanitizer-ubsan" title="連結到這個標頭">¶</a></h3>
<ul>
<li><p>The Implicit Conversion Sanitizer (<code class="docutils literal notranslate"><span class="pre">-fsanitize=implicit-conversion</span></code>) group
was extended. One more type of issues is caught - implicit integer sign change.
(<code class="docutils literal notranslate"><span class="pre">-fsanitize=implicit-integer-sign-change</span></code>).
This makes the Implicit Conversion Sanitizer feature-complete,
with only missing piece being bitfield handling.
While there is a <code class="docutils literal notranslate"><span class="pre">-Wsign-conversion</span></code> diagnostic group that catches this kind
of issues, it is both noisy, and does not catch <strong>all</strong> the cases.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span><span class="w"> </span><span class="nf">consume</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">);</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">consume</span><span class="p">(</span><span class="n">val</span><span class="p">);</span><span class="w"> </span><span class="c1">// If the value was negative, it is now large positive.</span>
<span class="w">  </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">consume</span><span class="p">((</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="n">val</span><span class="p">);</span><span class="w"> </span><span class="c1">// OK, the conversion is explicit.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Like some other <code class="docutils literal notranslate"><span class="pre">-fsanitize=integer</span></code> checks, these issues are <strong>not</strong>
undefined behaviour. But they are not <em>always</em> intentional, and are somewhat
hard to track down. This group is <strong>not</strong> enabled by <code class="docutils literal notranslate"><span class="pre">-fsanitize=undefined</span></code>,
but the <code class="docutils literal notranslate"><span class="pre">-fsanitize=implicit-integer-sign-change</span></code> check
is enabled by <code class="docutils literal notranslate"><span class="pre">-fsanitize=integer</span></code>.
(as is <code class="docutils literal notranslate"><span class="pre">-fsanitize=implicit-integer-truncation</span></code> check)</p>
</li>
<li><p>The Implicit Conversion Sanitizer (<code class="docutils literal notranslate"><span class="pre">-fsanitize=implicit-conversion</span></code>) has
learned to sanitize compound assignment operators.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">alignment</span></code> check has learned to sanitize the assume_aligned-like attributes:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="nf">__attribute__</span><span class="p">((</span><span class="n">align_value</span><span class="p">(</span><span class="mi">1024</span><span class="p">)))</span><span class="w"> </span><span class="n">aligned_char</span><span class="p">;</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">ac_struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">aligned_char</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="nf">load_from_ac_struct</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">ac_struct</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">;</span><span class="w"> </span><span class="c1">// &lt;- check that loaded &#39;a&#39; is aligned</span>
<span class="p">}</span>

<span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="nf">passthrough</span><span class="p">(</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">align_value</span><span class="p">(</span><span class="mi">1024</span><span class="p">)))</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// &lt;- check the pointer passed as function argument</span>
<span class="p">}</span>

<span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="nf">__attribute__</span><span class="p">((</span><span class="n">alloc_align</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
<span class="n">alloc_align</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">alignment</span><span class="p">);</span>

<span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="nf">caller</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">alloc_align</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">);</span><span class="w"> </span><span class="c1">// &lt;- check returned pointer</span>
<span class="p">}</span>

<span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="nf">__attribute__</span><span class="p">((</span><span class="n">assume_aligned</span><span class="p">(</span><span class="mi">1024</span><span class="p">)))</span><span class="w"> </span><span class="n">get_ptr</span><span class="p">();</span>

<span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="nf">caller2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">get_ptr</span><span class="p">();</span><span class="w"> </span><span class="c1">// &lt;- check returned pointer</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">caller3</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">__builtin_assume_aligned</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">);</span><span class="w">  </span><span class="c1">// &lt;- check returned pointer</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">caller4</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">offset</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">__builtin_assume_aligned</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">);</span><span class="w">  </span><span class="c1">// &lt;- check returned pointer accounting for the offest</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cp">#pragma omp for simd aligned(data : 1024) </span><span class="c1">// &lt;- aligned clause will be checked.</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">width</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="additional-information">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">Additional Information</a><a class="headerlink" href="#additional-information" title="連結到這個標頭">¶</a></h2>
<p>A wide variety of additional information is available on the <a class="reference external" href="https://clang.llvm.org/">Clang web
page</a>. The web page contains versions of the
API documentation which are up-to-date with the Subversion version of
the source code. You can access versions of these documents specific to
this release by going into the &quot;<code class="docutils literal notranslate"><span class="pre">clang/docs/</span></code>&quot; directory in the Clang
tree.</p>
<p>If you have any questions or comments about Clang, please feel free to
contact us via the <a class="reference external" href="https://lists.llvm.org/mailman/listinfo/cfe-dev">mailing
list</a>.</p>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="Bottom">
      
        <p>
        «&#160;&#160;<a href="index.html">Using Clang as a Compiler</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">內容</a>
        &#160;&#160;::&#160;&#160;
        <a href="UsersManual.html">Clang Compiler User's Manual</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; 版權所有 2007-2025, The Clang Team.
      使用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3 建立。
    </div>
  </body>
</html>