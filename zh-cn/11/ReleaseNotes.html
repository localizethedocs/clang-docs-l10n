<!DOCTYPE html>

<html lang="zh-CN" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Clang 11.0.0 Release Notes &#8212; Clang 11 文档</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="_static/haiku.css?v=fce32b03" />
    <script src="_static/documentation_options.js?v=6ed079f1"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/translations.js?v=beaddf03"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/clang-docs-l10n/ReleaseNotes.html" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="Clang Compiler User&#39;s Manual" href="UsersManual.html" />
    <link rel="prev" title="Using Clang as a Compiler" href="index.html" />
<script type="text/javascript" src="ltd-provenance.js"></script>
<script type="text/javascript" src="ltd-current.js"></script>
<script type="text/javascript" src="../../ltd-config.js"></script>
<script type="text/javascript" src="../../ltd-flyout.js"></script>

  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>Clang 11 文档</span></a></h1>
        <h2 class="heading"><span>Clang 11.0.0 Release Notes</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="Top">
      
        <p>
        «&#160;&#160;<a href="index.html">Using Clang as a Compiler</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">目录</a>
        &#160;&#160;::&#160;&#160;
        <a href="UsersManual.html">Clang Compiler User's Manual</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="clang-11-0-0-release-notes">
<h1>Clang 11.0.0 Release Notes<a class="headerlink" href="#clang-11-0-0-release-notes" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="id1">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id4">Introduction</a></p></li>
<li><p><a class="reference internal" href="#what-s-new-in-clang-11-0-0" id="id5">What's New in Clang 11.0.0?</a></p>
<ul>
<li><p><a class="reference internal" href="#recovery-ast" id="id6">Recovery AST</a></p></li>
<li><p><a class="reference internal" href="#improvements-to-clang-s-diagnostics" id="id7">Improvements to Clang's diagnostics</a></p></li>
<li><p><a class="reference internal" href="#non-comprehensive-list-of-changes-in-this-release" id="id8">Non-comprehensive list of changes in this release</a></p></li>
<li><p><a class="reference internal" href="#new-compiler-flags" id="id9">New Compiler Flags</a></p></li>
<li><p><a class="reference internal" href="#modified-compiler-flags" id="id10">Modified Compiler Flags</a></p></li>
<li><p><a class="reference internal" href="#new-pragmas-in-clang" id="id11">New Pragmas in Clang</a></p></li>
<li><p><a class="reference internal" href="#attribute-changes-in-clang" id="id12">Attribute Changes in Clang</a></p></li>
<li><p><a class="reference internal" href="#windows-support" id="id13">Windows Support</a></p></li>
<li><p><a class="reference internal" href="#c-language-changes-in-clang" id="id14">C Language Changes in Clang</a></p></li>
<li><p><a class="reference internal" href="#id2" id="id15">C++ Language Changes in Clang</a></p></li>
<li><p><a class="reference internal" href="#opencl-kernel-language-changes-in-clang" id="id16">OpenCL Kernel Language Changes in Clang</a></p></li>
<li><p><a class="reference internal" href="#changes-related-to-c-for-opencl" id="id17">Changes related to C++ for OpenCL</a></p></li>
<li><p><a class="reference internal" href="#abi-changes-in-clang" id="id18">ABI Changes in Clang</a></p></li>
<li><p><a class="reference internal" href="#openmp-support-in-clang" id="id19">OpenMP Support in Clang</a></p></li>
<li><p><a class="reference internal" href="#internal-api-changes" id="id20">Internal API Changes</a></p></li>
<li><p><a class="reference internal" href="#build-system-changes" id="id21">Build System Changes</a></p></li>
<li><p><a class="reference internal" href="#clang-format" id="id22">clang-format</a></p></li>
<li><p><a class="reference internal" href="#static-analyzer" id="id23">Static Analyzer</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#additional-information" id="id24">Additional Information</a></p></li>
</ul>
</nav>
<p>Written by the <a class="reference external" href="https://llvm.org/">LLVM Team</a></p>
<section id="introduction">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>This document contains the release notes for the Clang C/C++/Objective-C
frontend, part of the LLVM Compiler Infrastructure, release 11.0.0. Here we
describe the status of Clang in some detail, including major
improvements from the previous release and new feature work. For the
general LLVM release notes, see <a class="reference external" href="https://llvm.org/docs/ReleaseNotes.html">the LLVM
documentation</a>. All LLVM
releases may be downloaded from the <a class="reference external" href="https://llvm.org/releases/">LLVM releases web
site</a>.</p>
<p>For more information about Clang or LLVM, including information about the
latest release, please see the <a class="reference external" href="https://clang.llvm.org">Clang Web Site</a> or the
<a class="reference external" href="https://llvm.org">LLVM Web Site</a>.</p>
</section>
<section id="what-s-new-in-clang-11-0-0">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">What's New in Clang 11.0.0?</a><a class="headerlink" href="#what-s-new-in-clang-11-0-0" title="Link to this heading">¶</a></h2>
<p>Some of the major new features and improvements to Clang are listed
here. Generic improvements to Clang as a whole or to its underlying
infrastructure are described first, followed by language-specific
sections with improvements to Clang's support for those languages.</p>
<section id="recovery-ast">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Recovery AST</a><a class="headerlink" href="#recovery-ast" title="Link to this heading">¶</a></h3>
<p>clang's AST now improves support for representing broken C++ code. This improves
the quality of subsequent diagnostics after an error is encountered. It also
exposes more information to tools like clang-tidy and clangd that consume
clang’s AST, allowing them to be more accurate on broken code.</p>
<p>A RecoveryExpr is introduced in clang's AST, marking an expression containing
semantic errors. This preserves the source range and subexpressions of the
broken expression in the AST (rather than discarding the whole expression).</p>
<p>For the following invalid code:</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">NoArg</span><span class="p">();</span><span class="w"> </span><span class="c1">// Line 1</span>
<span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NoArg</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span><span class="w"> </span><span class="c1">// oops!</span>
</pre></div>
</div>
</div></blockquote>
<p>clang-10 produces the minimal placeholder:</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// VarDecl &lt;line:2:1, col:5&gt; col:5 x &#39;int&#39;</span>
</pre></div>
</div>
</div></blockquote>
<p>clang-11 produces a richer AST:</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// VarDecl &lt;line:2:1, col:16&gt; col:5 x &#39;int&#39; cinit</span>
<span class="c1">// `-RecoveryExpr &lt;col:9, col:16&gt; &#39;&lt;dependent type&gt;&#39; contains-errors lvalue</span>
<span class="c1">//    `-UnresolvedLookupExpr &lt;col:9&gt; &#39;&lt;overloaded function&gt;&#39; lvalue (ADL) = &#39;NoArg&#39;</span>
<span class="c1">//    `-IntegerLiteral &lt;col:15&gt; &#39;int&#39; 42</span>
</pre></div>
</div>
</div></blockquote>
<p>Note that error-dependent types and values may now occur outside a template
context. Tools may need to adjust assumptions about dependent code.</p>
<p>This feature is on by default for C++ code, and can be explicitly controlled
with <cite>-Xclang -f[no-]recovery-ast</cite>.</p>
</section>
<section id="improvements-to-clang-s-diagnostics">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Improvements to Clang's diagnostics</a><a class="headerlink" href="#improvements-to-clang-s-diagnostics" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>-Wpointer-to-int-cast is a new warning group. This group warns about C-style
casts of pointers to a integer type too small to hold all possible values.</p></li>
<li><p>-Wuninitialized-const-reference is a new warning controlled by
-Wuninitialized. It warns on cases where uninitialized variables are passed
as const reference arguments to a function.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Wimplicit-const-int-float-conversion</span></code> (enabled by default) is a new
option controlled by <code class="docutils literal notranslate"><span class="pre">-Wimplicit-int-float-conversion</span></code>.  It warns on
implicit conversion from a floating constant to an integer type.</p></li>
</ul>
</section>
<section id="non-comprehensive-list-of-changes-in-this-release">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Non-comprehensive list of changes in this release</a><a class="headerlink" href="#non-comprehensive-list-of-changes-in-this-release" title="Link to this heading">¶</a></h3>
<ul>
<li><p>For the ARM target, C-language intrinsics are now provided for the full Arm
v8.1-M MVE instruction set. <code class="docutils literal notranslate"><span class="pre">&lt;arm_mve.h&gt;</span></code> supports the complete API defined
in the Arm C Language Extensions.</p></li>
<li><p>For the ARM target, C-language intrinsics <code class="docutils literal notranslate"><span class="pre">&lt;arm_cde.h&gt;</span></code> for the CDE
instruction set are now provided.</p></li>
<li><p>clang adds support for a set of  extended integer types (<code class="docutils literal notranslate"><span class="pre">_ExtInt(N)</span></code>) that
permit non-power of 2 integers, exposing the LLVM integer types. Since a major
motivating use case for these types is to limit 'bit' usage, these types don't
automatically promote to 'int' when operations are done between two
<code class="docutils literal notranslate"><span class="pre">ExtInt(N)</span></code> types, instead math occurs at the size of the largest
<code class="docutils literal notranslate"><span class="pre">ExtInt(N)</span></code> type.</p></li>
<li><p>Users of UBSan, PGO, and coverage on Windows will now need to add clang's
library resource directory to their library search path. These features all
use runtime libraries, and Clang provides these libraries in its resource
directory. For example, if LLVM is installed in <code class="docutils literal notranslate"><span class="pre">C:\Program</span> <span class="pre">Files\LLVM</span></code>,
then the profile runtime library will appear at
<code class="docutils literal notranslate"><span class="pre">C:\Program</span> <span class="pre">Files\LLVM\lib\clang\11.0.0\lib\windows\clang_rt.profile-x86_64.lib</span></code>.
To ensure that the linker can find the appropriate library, users should pass
<code class="docutils literal notranslate"><span class="pre">/LIBPATH:C:\Program</span> <span class="pre">Files\LLVM\lib\clang\11.0.0\lib\windows</span></code> to the
linker. If the user links the program with the <code class="docutils literal notranslate"><span class="pre">clang</span></code> or <code class="docutils literal notranslate"><span class="pre">clang-cl</span></code>
drivers, the driver will pass this flag for them.</p></li>
<li><p>Clang's profile files generated through <code class="docutils literal notranslate"><span class="pre">-fprofile-instr-generate</span></code> are using
a fixed hashing algorithm that prevents some collision when loading
out-of-date profile informations. Clang can still read old profile files.</p></li>
<li><p>Clang adds support for the following macros that enable the
C-intrinsics from the <a class="reference external" href="https://developer.arm.com/documentation/100987/">Arm C language extensions for SVE</a> (version
<code class="docutils literal notranslate"><span class="pre">00bet5</span></code>, see section 2.1 for the list of intrinsics associated to
each macro):</p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Preprocessor macro</p></th>
<th class="head"><p>Target feature</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__ARM_FEATURE_SVE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">+sve</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__ARM_FEATURE_SVE_BF16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">+sve+bf16</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__ARM_FEATURE_SVE_MATMUL_FP32</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">+sve+f32mm</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__ARM_FEATURE_SVE_MATMUL_FP64</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">+sve+f64mm</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__ARM_FEATURE_SVE_MATMUL_INT8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">+sve+i8mm</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__ARM_FEATURE_SVE2</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">+sve2</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__ARM_FEATURE_SVE2_AES</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">+sve2-aes</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__ARM_FEATURE_SVE2_BITPERM</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">+sve2-bitperm</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">__ARM_FEATURE_SVE2_SHA3</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">+sve2-sha3</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">__ARM_FEATURE_SVE2_SM4</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">+sve2-sm4</span></code></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The macros enable users to write C/C++ <cite>Vector Length Agnostic
(VLA)</cite> loops, that can be executed on any CPU that implements the
underlying instructions supported by the C intrinsics, independently
of the hardware vector register size.</p>
<p>For example, the <code class="docutils literal notranslate"><span class="pre">__ARM_FEATURE_SVE</span></code> macro is enabled when
targeting AArch64 code generation by setting <code class="docutils literal notranslate"><span class="pre">-march=armv8-a+sve</span></code>
on the command line.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Example of VLA addition of two arrays with SVE ACLE.</span><a class="headerlink" href="#id3" title="Link to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Compile with:</span>
<span class="c1">// `clang++ -march=armv8a+sve ...` (for c++)</span>
<span class="c1">// `clang -stc=c11 -march=armv8a+sve ...` (for c)</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;arm_sve.h&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">VLA_add_arrays</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">svcntd</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">svbool_t</span><span class="w"> </span><span class="n">Pg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">svwhilelt_b64</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span>
<span class="w">    </span><span class="n">svfloat64_t</span><span class="w"> </span><span class="n">vx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">svld1</span><span class="p">(</span><span class="n">Pg</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">    </span><span class="n">svfloat64_t</span><span class="w"> </span><span class="n">vy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">svld1</span><span class="p">(</span><span class="n">Pg</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">    </span><span class="n">svfloat64_t</span><span class="w"> </span><span class="n">vout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">svadd_x</span><span class="p">(</span><span class="n">Pg</span><span class="p">,</span><span class="w"> </span><span class="n">vx</span><span class="p">,</span><span class="w"> </span><span class="n">vy</span><span class="p">);</span>
<span class="w">    </span><span class="n">svst1</span><span class="p">(</span><span class="n">Pg</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">vout</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Please note that support for lazy binding of SVE function calls is
incomplete. When you interface user code with SVE functions that are
provided through shared libraries, avoid using lazy binding. If you
use lazy binding, the results could be corrupted.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-O</span></code> maps to <code class="docutils literal notranslate"><span class="pre">-O1</span></code> instead of <code class="docutils literal notranslate"><span class="pre">-O2</span></code>.
(<a class="reference external" href="https://reviews.llvm.org/D79916">D79916</a>)</p></li>
<li><p>In a <code class="docutils literal notranslate"><span class="pre">-flto={full,thin}</span></code> link, <code class="docutils literal notranslate"><span class="pre">-Os</span></code>, <code class="docutils literal notranslate"><span class="pre">-Oz</span></code> and <code class="docutils literal notranslate"><span class="pre">-Og</span></code> can be used
now. <code class="docutils literal notranslate"><span class="pre">-Os</span></code> and <code class="docutils literal notranslate"><span class="pre">-Oz</span></code> map to the -O2 pipe line while <code class="docutils literal notranslate"><span class="pre">-Og</span></code> maps to the
-O1 pipeline.
(<a class="reference external" href="https://reviews.llvm.org/D79919">D79919</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--coverage</span></code> (gcov) defaults to gcov [4.8,8) compatible format now.</p></li>
<li><p>On x86, <code class="docutils literal notranslate"><span class="pre">-fpic/-fPIC</span> <span class="pre">-fno-semantic-interposition</span></code> assumes a global
definition of default visibility non-interposable and allows interprocedural
optimizations. In produced assembly <code class="docutils literal notranslate"><span class="pre">-Lfunc$local</span></code> local aliases are created
for global symbols of default visibility.</p></li>
</ul>
</section>
<section id="new-compiler-flags">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">New Compiler Flags</a><a class="headerlink" href="#new-compiler-flags" title="Link to this heading">¶</a></h3>
<ul>
<li><p>-fstack-clash-protection will provide a protection against the stack clash
attack for x86, s390x and ppc64 architectures through automatic probing of
each page of allocated stack.</p></li>
<li><p>-ffp-exception-behavior={ignore,maytrap,strict} allows the user to specify
the floating-point exception behavior. The default setting is <code class="docutils literal notranslate"><span class="pre">ignore</span></code>.</p></li>
<li><p>-ffp-model={precise,strict,fast} provides the user an umbrella option to
simplify access to the many single purpose floating point options. The default
setting is <code class="docutils literal notranslate"><span class="pre">precise</span></code>.</p></li>
<li><p>The default module cache has moved from /tmp to a per-user cache directory.
By default, this is ~/.cache but on some platforms or installations, this
might be elsewhere. The -fmodules-cache-path=... flag continues to work.</p></li>
<li><p>-fpch-instantiate-templates tries to instantiate templates already while
generating a precompiled header. Such templates do not need to be
instantiated every time the precompiled header is used, which saves compile
time. This may result in an error during the precompiled header generation
if the source header file is not self-contained. This option is enabled
by default for clang-cl.</p></li>
<li><p>-fpch-codegen and -fpch-debuginfo generate shared code and/or debuginfo
for contents of a precompiled header in a separate object file. This object
file needs to be linked in, but its contents do not need to be generated
for other objects using the precompiled header. This should usually save
compile time. If not using clang-cl, the separate object file needs to
be created explicitly from the precompiled header.
Example of use:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>clang++<span class="w"> </span>-x<span class="w"> </span>c++-header<span class="w"> </span>header.h<span class="w"> </span>-o<span class="w"> </span>header.pch<span class="w"> </span>-fpch-codegen<span class="w"> </span>-fpch-debuginfo
<span class="gp">$ </span>clang++<span class="w"> </span>-c<span class="w"> </span>header.pch<span class="w"> </span>-o<span class="w"> </span>shared.o
<span class="gp">$ </span>clang++<span class="w"> </span>-c<span class="w"> </span>source.cpp<span class="w"> </span>-o<span class="w"> </span>source.o<span class="w"> </span>-include-pch<span class="w"> </span>header.pch
<span class="gp">$ </span>clang++<span class="w"> </span>-o<span class="w"> </span>binary<span class="w"> </span>source.o<span class="w"> </span>shared.o
</pre></div>
</div>
<ul class="simple">
<li><p>Using -fpch-instantiate-templates when generating the precompiled header
usually increases the amount of code/debuginfo that can be shared.</p></li>
<li><p>In some cases, especially when building with optimizations enabled, using
-fpch-codegen may generate so much code in the shared object that compiling
it may be a net loss in build time.</p></li>
<li><p>Since headers may bring in private symbols of other libraries, it may be
sometimes necessary to discard unused symbols (such as by adding
-Wl,--gc-sections on ELF platforms to the linking command, and possibly
adding -fdata-sections -ffunction-sections to the command generating
the shared object).</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-fsanitize-coverage-allowlist</span></code> and <code class="docutils literal notranslate"><span class="pre">-fsanitize-coverage-blocklist</span></code> are added.</p></li>
<li><p>-mtls-size={12,24,32,48} allows selecting the size of the TLS (thread-local
storage) in the local exec TLS model of AArch64, which is the default TLS
model for non-PIC objects. Each value represents 4KB, 16MB (default), 4GB,
and 256TB (needs -mcmodel=large). This allows large/many thread local
variables or a compact/fast code in an executable.</p></li>
<li><p>-menable-experimental-extension` can be used to enable experimental or
unratified RISC-V extensions, allowing them to be targeted by specifying the
extension name and precise version number in the <cite>-march</cite> string. For these
experimental extensions, there is no expectation of ongoing support - the
compiler support will continue to change until the specification is
finalised.</p></li>
</ul>
</section>
<section id="modified-compiler-flags">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Modified Compiler Flags</a><a class="headerlink" href="#modified-compiler-flags" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>-fno-common has been enabled as the default for all targets.  Therefore, C
code that uses tentative definitions as definitions of a variable in multiple
translation units will trigger multiple-definition linker errors. Generally,
this occurs when the use of the <code class="docutils literal notranslate"><span class="pre">extern</span></code> keyword is neglected in the
declaration of a variable in a header file. In some cases, no specific
translation unit provides a definition of the variable. The previous
behavior can be restored by specifying <code class="docutils literal notranslate"><span class="pre">-fcommon</span></code>.</p></li>
<li><p>-Wasm-ignored-qualifier (ex. <cite>asm const (&quot;&quot;)</cite>) has been removed and replaced
with an error (this matches a recent change in GCC-9).</p></li>
<li><p>-Wasm-file-asm-volatile (ex. <cite>asm volatile (&quot;&quot;)</cite> at global scope) has been
removed and replaced with an error (this matches GCC's behavior).</p></li>
<li><p>Duplicate qualifiers on asm statements (ex. <cite>asm volatile volatile (&quot;&quot;)</cite>) no
longer produces a warning via -Wduplicate-decl-specifier, but now an error
(this matches GCC's behavior).</p></li>
<li><p>The deprecated argument <code class="docutils literal notranslate"><span class="pre">-f[no-]sanitize-recover</span></code> has changed to mean
<code class="docutils literal notranslate"><span class="pre">-f[no-]sanitize-recover=all</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">-f[no-]sanitize-recover=undefined,integer</span></code> and is no longer deprecated.</p></li>
<li><p>The argument to <code class="docutils literal notranslate"><span class="pre">-f[no-]sanitize-trap=...</span></code> is now optional and defaults to
<code class="docutils literal notranslate"><span class="pre">all</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-fno-char8_t</span></code> now disables the <code class="docutils literal notranslate"><span class="pre">char8_t</span></code> keyword, not just the use of
<code class="docutils literal notranslate"><span class="pre">char8_t</span></code> as the character type of <code class="docutils literal notranslate"><span class="pre">u8</span></code> literals. This restores the
Clang 8 behavior that regressed in Clang 9 and 10.</p></li>
<li><p>-print-targets has been added to print the registered targets.</p></li>
<li><p>-mcpu is now supported for RISC-V, and recognises the generic-rv32,
rocket-rv32, sifive-e31, generic-rv64, rocket-rv64, and sifive-u54 target
CPUs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-fwhole-program-vtables</span></code> (along with <code class="docutils literal notranslate"><span class="pre">-flto*</span></code>) now prepares all classes for possible whole program visibility if specified during the LTO link.
(<a class="reference external" href="https://reviews.llvm.org/D71913">D71913</a>)</p></li>
</ul>
</section>
<section id="new-pragmas-in-clang">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">New Pragmas in Clang</a><a class="headerlink" href="#new-pragmas-in-clang" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">clang</span> <span class="pre">max_tokens_here</span></code> pragma can be used together with
<a class="reference external" href="DiagnosticsReference.html#wmax-tokens">-Wmax-tokens</a> to emit a warning when
the number of preprocessor tokens exceeds a limit. Such limits can be helpful
in limiting code growth and slow compiles due to large header files.</p></li>
</ul>
</section>
<section id="attribute-changes-in-clang">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Attribute Changes in Clang</a><a class="headerlink" href="#attribute-changes-in-clang" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Attributes can now be specified by clang plugins. See the
<a class="reference external" href="ClangPlugins.html#defining-attributes">Clang Plugins</a> documentation for
details.</p></li>
</ul>
</section>
<section id="windows-support">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Windows Support</a><a class="headerlink" href="#windows-support" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Don't warn about <cite>ms_struct may not produce Microsoft-compatible layouts
for classes with base classes or virtual functions</cite> if the option is
enabled globally, as opposed to enabled on a specific class/struct or
on a specific section in the source files. This avoids needing to
couple <cite>-mms-bitfields</cite> with <cite>-Wno-incompatible-ms-struct</cite> if building
C++ code.</p></li>
<li><p>Enable <cite>-mms-bitfields</cite> by default for MinGW targets, matching a similar
change in GCC 4.7.</p></li>
</ul>
</section>
<section id="c-language-changes-in-clang">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">C Language Changes in Clang</a><a class="headerlink" href="#c-language-changes-in-clang" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>The default C language standard used when <cite>-std=</cite> is not specified has been
upgraded from gnu11 to gnu17.</p></li>
<li><p>Clang now supports the GNU C extension <cite>asm inline</cite>; it won't do anything
<em>yet</em>, but it will be parsed.</p></li>
</ul>
</section>
<section id="id2">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">C++ Language Changes in Clang</a><a class="headerlink" href="#id2" title="Link to this heading">¶</a></h3>
<ul>
<li><p>Clang now implements a restriction on giving non-C-compatible anonymous
structs a typedef name for linkage purposes, as described in C++ committee
paper <cite>P1766R1 &lt;http://wg21.link/p1766r1&gt;</cite>. This paper was adopted by the
C++ committee as a Defect Report resolution, so it is applied retroactively
to all C++ standard versions. This affects code such as:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="nf">f</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span><span class="w"> </span><span class="n">S</span><span class="p">;</span>
</pre></div>
</div>
<p>Previous versions of Clang rejected some constructs of this form
(specifically, where the linkage of the type happened to be computed
before the parser reached the typedef name); those cases are still rejected
in Clang 11. In addition, cases that previous versions of Clang did not
reject now produce an extension warning. This warning can be disabled with
the warning flag <code class="docutils literal notranslate"><span class="pre">-Wno-non-c-typedef-for-linkage</span></code>.</p>
<p>Affected code should be updated to provide a tag name for the anonymous
struct:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">S</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="nf">f</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>If the code is shared with a C compilation (for example, if the parts that
are not C-compatible are guarded with <code class="docutils literal notranslate"><span class="pre">#ifdef</span> <span class="pre">__cplusplus</span></code>), the typedef
declaration should be retained, but a tag name should still be provided:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">S</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="nf">f</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span><span class="w"> </span><span class="n">S</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="opencl-kernel-language-changes-in-clang">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">OpenCL Kernel Language Changes in Clang</a><a class="headerlink" href="#opencl-kernel-language-changes-in-clang" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Added extensions from <cite>cl_khr_subgroup_extensions</cite> to clang and the internal
header.</p></li>
<li><p>Added rocm device libs linking for AMDGPU.</p></li>
<li><p>Added diagnostic for OpenCL 2.0 blocks used in function arguments.</p></li>
<li><p>Fixed MS mangling for OpenCL 2.0 pipe type specifier.</p></li>
<li><p>Improved command line options for fast relaxed math.</p></li>
<li><p>Improved <cite>atomic_fetch_min/max</cite> functions in the internal header
(<cite>opencl-c.h</cite>).</p></li>
<li><p>Improved size of builtin function table for <cite>TableGen</cite>-based internal header
(enabled by <cite>-fdeclare-opencl-builtins</cite>) and added new functionality for
OpenCL 2.0 atomics, pipes, enqueue kernel, <cite>cl_khr_subgroups</cite>,
<cite>cl_arm_integer_dot_product</cite>.</p></li>
</ul>
</section>
<section id="changes-related-to-c-for-opencl">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Changes related to C++ for OpenCL</a><a class="headerlink" href="#changes-related-to-c-for-opencl" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Added <cite>addrspace_cast</cite> operator.</p></li>
<li><p>Improved address space deduction in templates.</p></li>
<li><p>Improved diagnostics of address spaces in nested pointer conversions.</p></li>
</ul>
</section>
<section id="abi-changes-in-clang">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">ABI Changes in Clang</a><a class="headerlink" href="#abi-changes-in-clang" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>For RISC-V, an ABI bug was fixed when passing complex single-precision
floats in RV64 with the hard float ABI. The bug could only be triggered for
function calls that exhaust the available FPRs.</p></li>
</ul>
</section>
<section id="openmp-support-in-clang">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">OpenMP Support in Clang</a><a class="headerlink" href="#openmp-support-in-clang" title="Link to this heading">¶</a></h3>
<p>New features for OpenMP 5.0 were implemented.</p>
<ul class="simple">
<li><p>OpenMP 5.0 is the default version supported by the compiler. User can switch
to OpenMP 4.5 using <code class="docutils literal notranslate"><span class="pre">-fopenmp-version=45</span></code> option.</p></li>
<li><p>Added support for declare variant directive.</p></li>
<li><p>Improved support of math functions and complex types for NVPTX target.</p></li>
<li><p>Added support for parallel execution of target regions for NVPTX target.</p></li>
<li><p>Added support for <code class="docutils literal notranslate"><span class="pre">scan</span></code> directives and <code class="docutils literal notranslate"><span class="pre">inscan</span></code> modifier in <code class="docutils literal notranslate"><span class="pre">reduction</span></code>
clauses.</p></li>
<li><p>Added support for <code class="docutils literal notranslate"><span class="pre">iterator</span></code> construct.</p></li>
<li><p>Added support for <code class="docutils literal notranslate"><span class="pre">depobj</span></code> construct.</p></li>
<li><p>Added support for <code class="docutils literal notranslate"><span class="pre">detach</span></code> clauses in task-based directives.</p></li>
<li><p>Added support for array shaping operations.</p></li>
<li><p>Added support for cancellation constructs in <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> directives.</p></li>
<li><p>Nonmonotonic modifier is allowed with all schedule kinds.</p></li>
<li><p>Added support for <code class="docutils literal notranslate"><span class="pre">task</span></code> and <code class="docutils literal notranslate"><span class="pre">default</span></code> modifiers in <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clauses.</p></li>
<li><p>Added support for strides in array sections.</p></li>
<li><p>Added support for <code class="docutils literal notranslate"><span class="pre">use_device_addr</span></code> clause.</p></li>
<li><p>Added support for <code class="docutils literal notranslate"><span class="pre">uses_allocators</span></code> clause.</p></li>
<li><p>Added support for <code class="docutils literal notranslate"><span class="pre">defaultmap</span></code> clause.</p></li>
<li><p>Added basic support for <code class="docutils literal notranslate"><span class="pre">hint</span></code> clause in <code class="docutils literal notranslate"><span class="pre">atomic</span></code> directives.</p></li>
<li><p>Added basic support for <code class="docutils literal notranslate"><span class="pre">affinity</span></code> clause.</p></li>
<li><p>Added basic support for <code class="docutils literal notranslate"><span class="pre">ancestor</span></code> modifier in <code class="docutils literal notranslate"><span class="pre">device</span></code> clause.</p></li>
<li><p>Added support for <code class="docutils literal notranslate"><span class="pre">default(firstprivate)</span></code> clause. This clause is the part of
upcoming OpenMP 5.1 and can be enabled using <code class="docutils literal notranslate"><span class="pre">-fopenmp-version=51</span></code> option.</p></li>
<li><p>Bug fixes and optimizations.</p></li>
</ul>
</section>
<section id="internal-api-changes">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">Internal API Changes</a><a class="headerlink" href="#internal-api-changes" title="Link to this heading">¶</a></h3>
<p>These are major API changes that have happened since the 10.0.0 release of
Clang. If upgrading an external codebase that uses Clang as a library,
this section should help get you past the largest hurdles of upgrading.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">RecursiveASTVisitor</span></code> no longer calls separate methods to visit specific
operator kinds. Previously, <code class="docutils literal notranslate"><span class="pre">RecursiveASTVisitor</span></code> treated unary, binary,
and compound assignment operators as if they were subclasses of the
corresponding AST node. For example, the binary operator plus was treated as
if it was a <code class="docutils literal notranslate"><span class="pre">BinAdd</span></code> subclass of the <code class="docutils literal notranslate"><span class="pre">BinaryOperator</span></code> class: during AST
traversal of a <code class="docutils literal notranslate"><span class="pre">BinaryOperator</span></code> AST node that had a <code class="docutils literal notranslate"><span class="pre">BO_Add</span></code> opcode,
<code class="docutils literal notranslate"><span class="pre">RecursiveASTVisitor</span></code> was calling the <code class="docutils literal notranslate"><span class="pre">TraverseBinAdd</span></code> method instead of
<code class="docutils literal notranslate"><span class="pre">TraverseBinaryOperator</span></code>. This feature was contributing a non-trivial
amount of complexity to the implementation of <code class="docutils literal notranslate"><span class="pre">RecursiveASTVisitor</span></code>, it was
used only in a minor way in Clang, was not tested, and as a result it was
buggy. Furthermore, this feature was creating a non-uniformity in the API.
Since this feature was not documented, it was quite difficult to figure out
how to use <code class="docutils literal notranslate"><span class="pre">RecursiveASTVisitor</span></code> to visit operators.</p>
<p>To update your code to the new uniform API, move the code from separate
visitation methods into methods that correspond to the actual AST node and
perform case analysis based on the operator opcode as needed:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TraverseUnary*()</span> <span class="pre">=&gt;</span> <span class="pre">TraverseUnaryOperator()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WalkUpFromUnary*()</span> <span class="pre">=&gt;</span> <span class="pre">WalkUpFromUnaryOperator()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VisitUnary*()</span> <span class="pre">=&gt;</span> <span class="pre">VisiUnaryOperator()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TraverseBin*()</span> <span class="pre">=&gt;</span> <span class="pre">TraverseBinaryOperator()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WalkUpFromBin*()</span> <span class="pre">=&gt;</span> <span class="pre">WalkUpFromBinaryOperator()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VisitBin*()</span> <span class="pre">=&gt;</span> <span class="pre">VisiBinaryOperator()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TraverseBin*Assign()</span> <span class="pre">=&gt;</span> <span class="pre">TraverseCompoundAssignOperator()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WalkUpFromBin*Assign()</span> <span class="pre">=&gt;</span> <span class="pre">WalkUpFromCompoundAssignOperator()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VisitBin*Assign()</span> <span class="pre">=&gt;</span> <span class="pre">VisiCompoundAssignOperator()</span></code></p></li>
</ul>
</li>
</ul>
</section>
<section id="build-system-changes">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Build System Changes</a><a class="headerlink" href="#build-system-changes" title="Link to this heading">¶</a></h3>
<p>These are major changes to the build system that have happened since the 10.0.0
release of Clang. Users of the build system should adjust accordingly.</p>
<ul class="simple">
<li><p>clang-tidy and clang-include-fixer are no longer compiled into libclang by
default. You can set <code class="docutils literal notranslate"><span class="pre">LIBCLANG_INCLUDE_CLANG_TOOLS_EXTRA=ON</span></code> to undo that,
but it's expected that that setting will go away eventually. If this is
something you need, please reach out to the mailing list to discuss possible
ways forward.</p></li>
</ul>
</section>
<section id="clang-format">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">clang-format</a><a class="headerlink" href="#clang-format" title="Link to this heading">¶</a></h3>
<ul>
<li><p>Option <code class="docutils literal notranslate"><span class="pre">IndentExternBlock</span></code> has been added to optionally apply indenting inside <code class="docutils literal notranslate"><span class="pre">extern</span> <span class="pre">&quot;C&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">extern</span> <span class="pre">&quot;C++&quot;</span></code> blocks.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IndentExternBlock</span></code> option accepts <code class="docutils literal notranslate"><span class="pre">AfterExternBlock</span></code> to use the old behavior, as well as Indent and NoIndent options, which map to true and false, respectively.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="nl">Indent</span><span class="p">:</span><span class="w">                       </span><span class="n">NoIndent</span><span class="o">:</span>
<span class="w"> </span><span class="cp">#ifdef __cplusplus          #ifdef __cplusplus</span>
<span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="p">{</span><span class="w">                </span><span class="k">extern</span><span class="w"> </span><span class="s">&quot;C++&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="cp">#endif                      #endif</span>

<span class="w">      </span><span class="kt">void</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w">          </span><span class="kt">void</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="w"> </span><span class="cp">#ifdef __cplusplus          #ifdef __cplusplus</span>
<span class="w"> </span><span class="p">}</span><span class="w">                           </span><span class="p">}</span>
<span class="w"> </span><span class="cp">#endif                      #endif</span>
</pre></div>
</div>
</li>
<li><p>Option <code class="docutils literal notranslate"><span class="pre">IndentCaseBlocks</span></code> has been added to support treating the block
following a switch case label as a scope block which gets indented itself.
It helps avoid having the closing bracket align with the switch statement's
closing bracket (when <code class="docutils literal notranslate"><span class="pre">IndentCaseLabels</span></code> is <code class="docutils literal notranslate"><span class="pre">false</span></code>).</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">fool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">                </span><span class="n">vs</span><span class="p">.</span><span class="w">     </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">fool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w">                                </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">{</span><span class="w">                                      </span><span class="n">bar</span><span class="p">();</span>
<span class="w">     </span><span class="n">bar</span><span class="p">();</span><span class="w">                            </span><span class="p">}</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w">                                    </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">break</span><span class="p">;</span><span class="w">                                 </span><span class="n">plop</span><span class="p">();</span>
<span class="k">default</span><span class="o">:</span><span class="w">                               </span><span class="p">}</span>
<span class="w">  </span><span class="p">{</span><span class="w">                                    </span><span class="p">}</span>
<span class="w">    </span><span class="n">plop</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Option <code class="docutils literal notranslate"><span class="pre">ObjCBreakBeforeNestedBlockParam</span></code> has been added to optionally apply
linebreaks for function arguments declarations before nested blocks.</p></li>
<li><p>Option <code class="docutils literal notranslate"><span class="pre">InsertTrailingCommas</span></code> can be set to <code class="docutils literal notranslate"><span class="pre">TCS_Wrapped</span></code> to insert
trailing commas in container literals (arrays and objects) that wrap across
multiple lines. It is currently only available for JavaScript and disabled by
default (<code class="docutils literal notranslate"><span class="pre">TCS_None</span></code>).</p></li>
<li><p>Option <code class="docutils literal notranslate"><span class="pre">BraceWrapping.BeforeLambdaBody</span></code> has been added to manage lambda
line break inside function parameter call in Allman style.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="nl">true</span><span class="p">:</span>
<span class="n">connect</span><span class="p">(</span>
<span class="w">  </span><span class="p">[]()</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">foo</span><span class="p">();</span>
<span class="w">    </span><span class="n">bar</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>

<span class="nl">false</span><span class="p">:</span>
<span class="n">connect</span><span class="p">([]()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">foo</span><span class="p">();</span>
<span class="w">    </span><span class="n">bar</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>
</pre></div>
</div>
</li>
<li><p>Option <code class="docutils literal notranslate"><span class="pre">AlignConsecutiveBitFields</span></code> has been added to align bit field
declarations across multiple adjacent lines</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="nl">true</span><span class="p">:</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">aaa</span><span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">a</span><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">bb</span><span class="w">   </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="nl">false</span><span class="p">:</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">aaa</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>Option <code class="docutils literal notranslate"><span class="pre">BraceWrapping.BeforeWhile</span></code> has been added to allow wrapping
before the <code class="docutils literal notranslate"><span class="pre">`while</span></code> in a do..while loop. By default the value is (<code class="docutils literal notranslate"><span class="pre">false</span></code>)</p>
<p>In previous releases <code class="docutils literal notranslate"><span class="pre">IndentBraces</span></code> implied <code class="docutils literal notranslate"><span class="pre">BraceWrapping.BeforeWhile</span></code>.
If using a Custom BraceWrapping style you may need to now set
<code class="docutils literal notranslate"><span class="pre">BraceWrapping.BeforeWhile</span></code> to (<code class="docutils literal notranslate"><span class="pre">true</span></code>) to be explicit.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="nl">true</span><span class="p">:</span>
<span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">foo</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nl">false</span><span class="p">:</span>
<span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">foo</span><span class="p">();</span>
<span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="static-analyzer">
<span id="release-notes-clang-static-analyzer"></span><h3><a class="toc-backref" href="#id23" role="doc-backlink">Static Analyzer</a><a class="headerlink" href="#static-analyzer" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Improved the analyzer's understanding of inherited C++ constructors.</p></li>
<li><p>Improved the analyzer's understanding of dynamic class method dispatching in
Objective-C.</p></li>
<li><p>Greatly improved the analyzer's constraint solver by better understanding
when constraints are imposed on multiple symbolic values that are known to be
equal or known to be non-equal. It will now also efficiently reject impossible
if-branches between known comparison expressions.</p></li>
<li><p>Added <a class="reference internal" href="analyzer/user-docs/CrossTranslationUnit.html#ctu-on-demand"><span class="std std-ref">on-demand parsing</span></a> capability to Cross Translation
Unit (CTU) analysis.</p></li>
<li><p>Numerous fixes and improvements for the HTML output.</p></li>
<li><p>New checker: <a class="reference internal" href="analyzer/checkers.html#alpha-core-c11lock"><span class="std std-ref">alpha.core.C11Lock</span></a> and
<a class="reference internal" href="analyzer/checkers.html#alpha-fuchsia-lock"><span class="std std-ref">alpha.fuchsia.Lock</span></a> checks for their respective
locking APIs.</p></li>
<li><p>New checker: <a class="reference internal" href="analyzer/checkers.html#alpha-security-cert-pos-34c"><span class="std std-ref">alpha.security.cert.pos.34c</span></a>
finds calls to <code class="docutils literal notranslate"><span class="pre">putenv</span></code> where a pointer to an autmoatic variable is passed
as an argument.</p></li>
<li><p>New checker: <a class="reference internal" href="analyzer/checkers.html#webkit-nouncountedmemberchecker"><span class="std std-ref">webkit.NoUncountedMemberChecker</span></a> to enforce the existence of virtual
destructors for all uncounted types used as base classes.</p></li>
<li><p>New checker: <a class="reference internal" href="analyzer/checkers.html#webkit-refcntblbasevirtualdtor"><span class="std std-ref">webkit.RefCntblBaseVirtualDtor</span></a> checks that only ref-counted types
are used as class members, not raw pointers and references to uncounted
types.</p></li>
<li><p>New checker: <a class="reference internal" href="analyzer/checkers.html#alpha-cplusplus-smartptr"><span class="std std-ref">alpha.cplusplus.SmartPtr</span></a> check
for dereference of null smart pointers.</p></li>
<li><p>Moved <code class="docutils literal notranslate"><span class="pre">PlacementNewChecker</span></code> out of alpha, making it enabled by default.</p></li>
<li><p>Added support for multi-dimensional variadic arrays in <code class="docutils literal notranslate"><span class="pre">core.VLASize</span></code>.</p></li>
<li><p>Added a check for insufficient storage in array placement new calls, as well
as support for alignment variants to <code class="docutils literal notranslate"><span class="pre">cplusplus.PlacementNew</span></code>.</p></li>
<li><p>While still in alpha, <code class="docutils literal notranslate"><span class="pre">alpha.unix.PthreadLock</span></code>, the iterator and container
modeling infrastructure, <code class="docutils literal notranslate"><span class="pre">alpha.unix.Stream</span></code>, and taint analysis were
improved greatly. An ongoing, currently off-by-default improvement was made on
the pre-condition modeling of several functions defined in the POSIX standard.</p></li>
<li><p>Improved the warning messages of several checkers.</p></li>
<li><p>Fixed a few remaining cases of checkers emitting reports under incorrect
checker names, and employed a few restrictions to more easily identify and
avoid such errors.</p></li>
<li><p>Moved several non-reporting checkers (those that model, among other things,
standard functions, but emit no diagnostics) to be listed under
<code class="docutils literal notranslate"><span class="pre">-analyzer-checker-help-developer</span></code> instead of <code class="docutils literal notranslate"><span class="pre">-analyzer-checker-help</span></code>.
Manually enabling or disabling checkers found on this list is not supported
in production.</p></li>
<li><p>Numerous fixes for crashes, false positives and false negatives in
<code class="docutils literal notranslate"><span class="pre">unix.Malloc</span></code>, <code class="docutils literal notranslate"><span class="pre">osx.cocoa.NSError</span></code>, and several other checkers.</p></li>
<li><p>Implemented a dockerized testing system to more easily determine the
correctness and performance impact of a change to the static analyzer itself.
The currently beta-version tool is found in
<code class="docutils literal notranslate"><span class="pre">(llvm-project</span> <span class="pre">repository)/clang/utils/analyzer/SATest.py</span></code>.</p></li>
</ul>
</section>
</section>
<section id="additional-information">
<span id="release-notes-ubsan"></span><h2><a class="toc-backref" href="#id24" role="doc-backlink">Additional Information</a><a class="headerlink" href="#additional-information" title="Link to this heading">¶</a></h2>
<p>A wide variety of additional information is available on the <a class="reference external" href="https://clang.llvm.org/">Clang web
page</a>. The web page contains versions of the
API documentation which are up-to-date with the Git version of
the source code. You can access versions of these documents specific to
this release by going into the &quot;<code class="docutils literal notranslate"><span class="pre">clang/docs/</span></code>&quot; directory in the Clang
tree.</p>
<p>If you have any questions or comments about Clang, please feel free to
contact us via the <a class="reference external" href="https://lists.llvm.org/mailman/listinfo/cfe-dev">mailing
list</a>.</p>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="Bottom">
      
        <p>
        «&#160;&#160;<a href="index.html">Using Clang as a Compiler</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">目录</a>
        &#160;&#160;::&#160;&#160;
        <a href="UsersManual.html">Clang Compiler User's Manual</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; 版权所有 2007-2025, The Clang Team.
      由 <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3创建。
    </div>
  </body>
</html>